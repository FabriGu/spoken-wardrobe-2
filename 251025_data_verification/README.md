# Cage-Based Deformation Verification System

**Date**: October 25, 2025

## Purpose

This directory contains tools to **verify and visualize** the cage-based deformation system without altering the main `test_integration.py` logic.

## Tools

### 1. `verify_cage_structure.py`

Analyzes the cage generated by the current system to answer:

- ✓ Is the cage anatomically structured?
- ✓ How many vertices per body part?
- ✓ Does it tightly bound the mesh?

### 2. `verify_mvc_weights.py`

Checks the MVC weight computation:

- ✓ Are weights computed once and stored?
- ✓ Do weights sum to 1 per vertex?
- ✓ What's the weight matrix shape?

### 3. `verify_deformation.py`

Visualizes real-time deformation:

- ✓ Do cage sections move independently?
- ✓ Does the mesh follow the cage smoothly?
- ✓ Is there proper keypoint-to-cage mapping?

### 4. `verification_server.py` + `verification_viewer.html`

Web-based visualization (reuses WebSocket logic from `test_integration.py`):

- Shows mesh + cage simultaneously
- Color-codes cage sections by body part
- Displays MVC weight heatmaps
- Shows keypoint-to-cage vertex connections

## Usage

### Quick Check: Cage Structure

```bash
python 251025_data_verification/verify_cage_structure.py
```

### Quick Check: MVC Weights

```bash
python 251025_data_verification/verify_mvc_weights.py
```

### Full Visualization (with camera)

```bash
python 251025_data_verification/verify_deformation.py
```

Then open `251025_data_verification/verification_viewer.html` in your browser.

## What to Look For

### ✅ Good Cage Structure

- ~30-60 total vertices
- Clear sections: torso (8 verts), each arm (6-8 verts), etc.
- Tightly bounds the mesh
- Vertices grouped by anatomical region

### ❌ Bad Cage Structure (Current Problem)

- 400-500 vertices (too many!)
- No clear anatomical boundaries
- Vertices scattered uniformly
- Cage is just a bounding box or convex hull

### ✅ Correct MVC Weights

- Shape: `(num_mesh_verts, num_cage_verts)`
- Each row sums to 1.0
- Computed ONCE during initialization
- NOT recomputed per frame

### ✅ Proper Deformation

- Cage sections move independently
- Left arm cage moves when left arm moves
- Mesh smoothly follows cage
- No "smearing" or distortion
